<h4>Possible Actions for '{{ name }}'</h4>

{% for (identifier, wfname, description) in workflows %}
    <div class='well'>
        <p><strong>{{ wfname }}</strong></p>
        <p>{{ description }}</p>
        <a id='runWorkflowBtn' class='workflow btn' name='{{ name }}' path='{{ path }}' identifier='{{ identifier }}'>Run</a>
        <a id="showResults" style="display:none;" class='workflow btn' href="" target="_blank">Show results</a>
        <a id="showProgress" style="display:none;" class='workflow btn' href="" target="_blank">Show progress</a>
        <a id="showProvenance" style="display:none;" class='workflow btn' href="#">Show Provenance</a>
    </div>
{% endfor %}

<script>
function basename(path) {
    return path.replace(/\\/g,'/').replace( /.*\//, '' );
}
function updateStatus(status) {
	if (status == 'finished') {
		$("#showResults").show();
		$("#runWorkflowBtn").html('Re-run');
		$("#runWorkflowBtn").removeClass("disabled")
		$("#showProgress").hide();
		$("#showProvenance").show();
	} else if (status == 'running') {
		$("#runWorkflowBtn").addClass('disabled');
		$("#showProgress").show();
		$("#showProvenance").hide();
	} else if (status == 'no workflow') {
		$("#showResults").hide();
		$("#runWorkflowBtn").html("Run");
		$("#runWorkflowBtn").removeClass("disabled")
		$("#showProgress").hide();
		$("#showProvenance").show();
	}
}

function callUpdateStatus() {
	console.log("callupdatestatus");
	var path = $('#runWorkflowBtn').attr("path");
	var identifier = $('#runWorkflowBtn').attr("identifier");
	var name = $('#runWorkflowBtn').attr("name");
	var path = $('#runWorkflowBtn').attr("path");
	$.get('http://semweb.cs.vu.nl/hackathon/backend/workflow/status?path=' + encodeURIComponent(path) + '&name=' + encodeURIComponent(name) + '&workflowId=' + encodeURIComponent(identifier), function( jsonResult ) {
		  updateStatus(jsonResult['status']);
		});
	console.log("callupdatestatus2");
}

function updateShowResultsHref() {
	console.log("updateshowresultshref");
	var identifier = $('#runWorkflowBtn').attr("identifier");
	var path = $('#runWorkflowBtn').attr("path");
	$("#showResults").attr("href","http://semweb.cs.vu.nl/hackathon/results/" + path + "/" + identifier + "/report/index.html");
}

$(function() {
	updateShowResultsHref();
	callUpdateStatus();
    $('#runWorkflowBtn').on('click', function(){
    	
    	var identifier = $(this).attr("identifier");
		var path = $(this).attr("path");
		var name = $(this).attr("name");
    	$.get('{{ url_for("execWorkflow") }}', {path : path, workflowId: identifier, name: name});
    	
    	$(this).addClass('disabled');
        $("#showResults").show();
        $("#showProvenance").show();
    });
	$('#showProvenance').on('click', function(){
    	
    	var identifier = $("#runWorkflowBtn").attr("identifier");
		var path = $("#runWorkflowBtn").attr("path");
		var name = $("#runWorkflowBtn").attr("name");
    	$.get('{{ url_for("pushProvenanceResult") }}', {path : path, workflowId: identifier, name: name}, function( jsonResult ) {
    			window.open("http://semweb.cs.vu.nl/provoviz?endpoint_uri=" + encodeURIComponent("http://semweb.cs.vu.nl:8080/openrdf-sesame/repositories/ct"), "_blank");
	  		}
    	
    	);
    	
    });
});
</script>
