<h4>Possible Actions for '{{ name }}'</h4>

{% for w in workflows %}
    <div id='{{ w.id }}' class='well'>

        <p><strong>{{ w.name }}</strong></p>
        <p>{{ w.description }}</p>
        <a id='{{ w.id }}runWorkflowBtn' onClick="runWorkflow(this);" class='workflow btn btn-default' name='{{ name }}' path='{{ path }}' identifier='{{ w.id }}'>Run</a>
        <a id="{{ w.id }}showResults" style="display:none;" class='workflow btn btn-default' href="http://semweb.cs.vu.nl/hackathon/results/{{ path }}/{{ w.id }}/report/index.html" target="_blank">Show results</a>
        <a id="{{ w.id }}showProgress" style="display:none;" class='workflow btn btn-default' href="" target="_blank">Show progress</a>
        <a id="{{ w.id }}showProvenance" onClick="showProvenance(this)" style="display:none;" class='workflow btn' href="#" name='{{ name }}' path='{{ path }}' identifier='{{ w.id }}'>Show Provenance</a>
    </div>
    <script type="text/javascript">
    function {{ w.id }}updateStatus(status) {
    	if (status == 'finished') {
    		$("#{{ w.id }}showResults").show();
    		$("#{{ w.id }}runWorkflowBtn").html('Re-run');
    		$("#{{ w.id }}runWorkflowBtn").removeClass("disabled")
    		$("#{{ w.id }}showProgress").hide();
    		$("#{{ w.id }}showProvenance").show();
    	} else if (status == 'running') {
    		$("#{{ w.id }}runWorkflowBtn").addClass('disabled');
    		$("#{{ w.id }}showProgress").show();
    		$("#{{ w.id }}showProvenance").hide();
    	} else if (status == 'no workflow') {
    		$("#{{ w.id }}showResults").hide();
    		$("#{{ w.id }}runWorkflowBtn").html("Run");
    		$("#{{ w.id }}runWorkflowBtn").removeClass("disabled")
    		$("#{{ w.id }}showProgress").hide();
    		$("#{{ w.id }}showProvenance").show();
    	}
    }

    function {{ w.id }}callUpdateStatus() {
    	$.get('{{ url_for("get_workflow_status") }}', {path: '{{ path }}', name: '{{name}}', identifier: '{{w.id}}' }, function( data ) {
    	    {{ w.id }}updateStatus(data.status);
    	});
    }
    
    $(function() {
    	{{ w.id }}callUpdateStatus();
    });
    </script>
{% endfor %}

<script>
function basename(path) {
    return path.replace(/\\/g,'/').replace( /.*\//, '' );
}

function runWorkflow(runWorkflowButton) {
	var element = $(runWorkflowButton);
	var identifier = element.attr("identifier");
	var path = element.attr("path");
	var name = element.attr("name");
	$.get('{{ url_for("run_workflow") }}', {path : path, identifier: identifier, name: name});
	
	element.addClass('disabled');
	$("#" + identifier + "showResults").show();
	$("#" + identifier + "showProvenance").show();
}

function showProvenance(provenanceButton) {
	var element = $(provenanceButton);
	var identifier = element.attr("identifier");
	var path = element.attr("path");
	var name = element.attr("name");
	
	element.removeClass('btn-danger');
	element.removeClass('btn-success');
	
	$.get('{{ url_for("upload_workflow_provenance") }}', {path : path, identifier: identifier, name: name}, function( data ) {
		if (data.status == 'false') {
			console.log("Something went wrong while uploading the workflow provenance to sesame.");
			element.addClass('btn-danger');
		} else {
			console.log("Everything went very well.");
			var endpoint_uri = encodeURIComponent("http://semweb.cs.vu.nl:8080/openrdf-sesame/repositories/goldendemo");
			element.addClass('btn-success');
			window.open("http://semweb.cs.vu.nl/provoviz?endpoint_uri=" + endpoint_uri, "_blank");
		}
		
	    
	});
}

</script>
